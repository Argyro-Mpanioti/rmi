# rmi

## Κλάση Account

Η κλάση Account χρησιμοποιείται για την παραγωγή αντικειμένων που αντιπροσωπεύουν λογαριασμούς.

### Πεδία
Η κλάση έχει ως πεδία:
* το String username, που είναι το username του λογαριασμού
* το ακέραιο authToken, που είναι ένας ακέραιος αριθμός που δίνεται στον λογαριασμό
* τη λίστα messageBox, που περιέχει τα μηνύματα που έχει λάβει ο λογαρισμός.

Κάθε λογαριασμός έχει διαφορετικό authToken.

### Μέθοδοι
Η κλάση εχει έναν κατασκευαστή που δέχεται το username και το authToken ως παραμέτρους και αρχικοποιεί με αυτά τα αντίστοιχα πεδία και επίσης αρχικοποιεί το messageBox σε μία κενή λίστα.


## Κλάση Message

Η κλάση Message χρησιμοποιείται για την παραγωγή αντικειμένων που αντιπροσωπεύουν μηνύματα.

### Πεδία
Η κλάση έχει ως πεδία:
* το boolean isRead, που έχει την τιμή true μόνο όταν το μήνυμα έχει διαβαστεί
* το String sender, που περιέχει το username του αποστολέα του μηνύματος
* το String receiver, που περιέχει το username του παραλήπτη του μηνύματος
* το String body, που περιέχει το κείμενο του μηνύματος
* το ακέραιο id, που είναι ένας ακέραιος αριθμός που δίνεται στο μήνυμα.

Κάθε μήνυμα έχει ξεχωριστό id.

### Μέθοδοι
Η κλάση έχει μία μέθοδο info η οποία επιστρέφει ένα String που δείχνει τις πληροφορίες του μηνύματος με την μορφή id. from: sender* αν δεν έχει διαβαστεί ακόμη και id. from: sender αν έχει διαβαστεί.

Παραδείγματος χάρην: αν το μήνυμά μας έχει id 5, αποστολέα τον χρήστη με username thisUser και δεν έχει διαβαστεί τότε επιστρέφεται το εξής: 5. from: thisUser* 

Επίσης έχει έναν κατασκευαστή που δέχεται το username του sender, το username του receiver, το κείμενο και το id ως παραμέτρους και αρχικοποιεί με αυτά τα αντίστοιχα πεδία και επίσης αρχικοποιεί το isRead ως false.


## Κλάση MessagingServer

Η κλάση MessagingServer υλοποιεί την υπηρεσία του server.

### Πεδία

Η κλάση περιέχει ως πεδία:
* την λίστα accounts, που περιέχει όλους τους λογαριασμούς που δημιουργούνται ενώ τρέχει ο server
* το ακέραιο authTokensCounter, που αυξάνεται κατά 1 κάθε φορά που δημιουργείται ενας νέος λογαριασμός και γίνεται το authToken του λογαριασμού αυτού
* το ακέραιο messageIdsCounter, που αυξάνεται κατά 1 κάθε φορά που δημιουργείται ενα νέο μήνυμα και γίνεται το id του μηνύματος αυτού

Όλα τα παραπάνω πεδία είναι global γιατί χρειαζόμαστε πρόσβαση σε αυτά από την κλάση RemoteMessagingApp.

### Μέθοδοι

Η κλάση έχει μία μέθοδο main η οποία αρχικοποιεί το accounts σε μία κενή λίστα, το authTokensCounter σε 0 και το messageIdsCounter σε 0. Επίσης, ορίζει ως portNumber την 1η παράμετρο με την οποία τρέχουμε τον server. Στη συνέχεια φτιάχνει το remote αντικείμενο stub, δημιουργεί registry στην θύρα portNumber και το συνδέει με το stub με όνομα "messaging".


## Κλάση MessagingClient

Η κλάση MessagingClient υλοποιεί την υπηρεσία του client.

### Μέθοδοι

Η κλάση έχει μία μέθοδο main η οποία ορίζει ως ip την 1η παράμετρο με την οποία τρέχουμε τον client, ως portNumber την 2η παράμετρο με την οποία τρέχουμε τον client, ως FN_ID την 3η παράμετρο με την οποία τρέχουμε τον client και αποθηκεύει τις υπόλοιπες παραμέτρους με τις οποίες τρέχουμε τον client στον πίνακα argsRest. Στη συνέχεια βρίσκει το registry της θύρας portNumber και φτιάχνει το remote αντικείμενο stub με αναζήτηση του ονόματος "messaging" στο registry. Έπειτα, η main καλεί την DoFN_ID με παραμέτρους το stub, το FN_ID και τον πίνακα argsRest και εκτυπώνει το αποτέλεσμά της.

Η μέθοδος DoFN_ID εκτελεί την διεργασία που δηλώνει το ακέρσιο FN_ID το οποίο δέχεται ως παράμετρο με βάση τις υπόλοιπες παραμέτρους argsRest. Αυτό το κάνει καλώντας την αντίστοιχη μέθοδο του stub που δηλώνεται στο interface MessagingAppInt και υλοποιείται στην κλάση RemoteMessagingApp και αποθηκεύοντας το μήνυμα που επιστρέφει κάθε μέθοδος. Σε περίπτωση που το FN_ID είναι διάφορο του 1, δηλαδή δεν δημιουργείται λογαριασμός αλλά εκτελούμε ενέργεια από λογαριασμό που ήδη υπάρχει τότε γίνεται πρώτα έλεγχος αν το authToken αντιστοιχεί σε κάποιον υπάρχοντα λογαριασμό. Αν όχι, τότε επιστρέφεται το μήνυμα "Invalid Auth Token".


## Interface MessagingAppInt

Το interface MessagingAppInt περιέχει τις δηλώσεις των συναρτήσεων που καλεί ο client και υλοποιεί ο server στην κλάση RemoteMessagingApp.


## Κλάση RemoteMessagingApp

Η κλάση RemoteMessagingApp υλοποιεί τις μεθόδους του interface MessagingAppInt.

### Μέθοδοι

Οι μέθοδοι που υπάρχουν είναι:

* ένας κενός κατασκευαστής που καλεί τον κατασκευαστή της UnicastRemoteObject

* #### CheckAuthToken:

  Η μέθοδος CheckAuthToken δέχεται ένα ακέραιο authToken και ελέγχει υπάρχει λογαριασμός που να έχει αυτόν τον ακέραιο ως authToken. Αν υπάρχει, τότε επιστρέφει true. Αλλιώς, επιστρέφει false.
  
* #### IsUsernameValid:
  
  Η μέθοδος IsUsernameValid δέχεται ως παράμετρο ένα username και επιστρέφει true αν και μόνο αν το username περιέχει μόνο αλφαριθμητικά και τον ειδικό χαρακτήρα "\_". Αυτό ελέγχεται με τον εξής τρόπο: γίνεται αντικατάσταση των αλφαριθμητικών και των χαρακτήρων "\_" με το κενό και ελέγχεται αν το username είναι κενό.
  
* #### CreateAccount:

  Η μέθοδος CreateAcccount δέχεται ένα String username και προσπαθεί να δημιουργήσει έναν λογαριασμό με αυτό το username και επιστρέφει ένα String output.

  Αν το username περιέχει χαρακτήρες που δεν είναι αλφαριθμητικα ή ο ειδικός χαρακτήρας "/_" τότε δεν δημιουργείται λογαριασμός και επιστρέφεται το output "Invalid Username". Αν όχι, τότε ελέγχεται αν υπάρχει ήδη λογαριασμός στην global λίστα με τους λογαριασμούς accounts του MessagingServer.

  Αν υπάρχει λογαριασμός με αυτό το username τότε επιστρέφεται το output "Sorry, the user already exists". Αλλιώς αυξάνεται ο global μετρητής των λογαριασμών authTokensCounter του MessagingServer κατά 1, δημιουργείται νέος λογαριασμός με το username ως username και το authTokensCounter ως authToken, ο νέος λογαριασμός προστίθεται στην global λίστα με τους λογαριασμούς accounts του MessagingServer και το output παίρνει την τιμη του authToken σε String.

  Σε κάθε περίπτωση επιστρέφεται το output.

* #### ShowAccounts:

  Η μέθοδος ShowAccounts επιστρέφει ένα String με όλους τα username ολων των λογαριασμών που εχουν δημιουργηθεί από όταν άρχισε να τρέχει ο server.
  
  Η μέθοδος έχει ένα κενό String output. Με μία for που διατρέχει την λίστα accounts του server τα usernames ολων των χρηστών προστίθενται στο output αριθμημένα (η αρίθμηση ξεκινάει από το 1 και γι' αυτό στον κώδικα υπάρχει το i+1). Η γραμμή αμέσως μετά την for υπάρχει έτσι ώστε να αφαιρείται ο τελευταίος χαρακτήρας του output, δηλαδή η αλλαγή γραμμής μετά την εμφάνιση του τελευταίου username. Πρέπει να υπάρχει τουλάχιστον ένας λογαριασμός για να εκτελεστεί η ShowAccounts άρα δεν υπάρχει περίπτωση να είναι κενό το output οπότε μπορούμε πάντα να αφαιρέσουμε τον τελευταίο χαρακτήρα. Τελικά επιστρέφεται το output.

* ####  SendMessage:  

  Η μέθοδος SendMessage δέχεται το ακέραιο senderAuthToken, που είναι το authToken του αποστολέα του μηνύματος, το String recipientUsername, που είναι το username του παραλήπτη του μηνύματος και το String messageBody, που είναι το κείμενο του μηνύματος.
  
  Αρχικά, η μέθοδος ελέγχει αν υπάρχει λογαριασμός με username το recipientUsername. Αν όχι, τότε το output παίρνει την τιμή "User does not exist". 
  
  Αν ναι, τότε βρίσκει το username του αποστολέα μέσω του authToken του από τον πίνακα acounts του server και του στέλενει το μήνυμα. Στην συνέχεια αυξάνεται ο messageIdCounter κατά 1 και δημιουργείται το μήνυμα με τα usernames αποστολέα και παραλήπτη, το κείμενο του μηνύματος και το messageIdCounter, το οποίο αποτελεί το id του μηνύματος. Τελικά, το μήνυμα προστίθεται στην λίστα messageBox του recipient και το output παίρνει την τιμή "OK".
  
  Σε κάθε περίπτωση επιστρέφεται το output.

  Ο έλεγχος για τον αν υπάρχει λογαριασμός με authToken το recipientAuthToken δεν γίνεται με την CheckAuthToken γιατί χρειάζεται να βρούμε και τον λογαριασμό του αποδέκτη του μηνύματος για να βάλουμε το μήνυμα στο messageBox του.
  
  Ισχύει ότι το senderAuthToken σίγουρα είναι authToken κάποιου λογαριασμού γιατί έχει ελεγχθεί στον client ότι το authToken αντιστοιχεί σε λογαριασμό που υπάρχει.

* #### ShowInbox:  

  Η μέθοδος ShowInbox δέχεται το ακέραιο authToken και επιστρέφει ένα String το οποίο περιέχει όλα τα μηνύματα του messageBox του λογαριασμού με αυτό το authToken χωρισμένα με αλλαγή γραμμής. Ο λογαριασμός αυτός σίγουρα υπάρχει γιατί έχει ελεγχθεί στον client ότι το authToken αντιστοιχεί σε λογαριασμό που υπάρχει. Τα μηνύματα έχουν την μορφή την οποία παίρνουν από την συνάρτηση info της κλασης Message. Με μία for αυτά τοποθετούνται σε ένα String output χωρισμένα με αλλαγή γραμμής.
   Η if αμέσως μετά την for υπάρχει έτσι ώστε να αφαιρείται η αλλαγή γραμμής μετά την εμφάνιση του τελευταίου μηνύματος. Στην ShowAccounts είχαμε μόνο το περιεχόμενο της if χωρίς να κάνουμε τον έλεγχο της if. Αυτή η διαφορά οφείλεται στο γεγονός ότι για να εκτελεστεί η ShowAccounts πρέπει να υπάρχει τουλάχιστον ένας λογαριασμός άρα δεν υπάρχει περίπτωση να είναι κενό το output ενώ το messageBox μπορεί να είναι άδειο άρα το output μπορεί να είναι κενό. Οπότε εδώ πρέπει να ελέγξουμε αν μπορούμε να αφαιρέσουμε τον τελευταίο χαρακτήρα του output.

* #### ReadMessage:  

  Η μέθοδος ReadMessage δέχεται το String receiverAuthToken και το ακέραιο messageId και επιστρέφει ένα String που περιέχει το μήνυμα με id το messageId αν το έχει λάβει ο λογαριασμός με authToken το receiverAuthToken. Αν δεν το έχει λάβει τότε επιστρέφει το String "Message ID does not exist".

  Αρχικά εντοπίζεται ο λογαριασμός receiver που έχει authToken το receiverAuthToken. Αυτός ο λογαριασμός σίγουρα υπάρχει γιατί ελεγχθεί στον client ότι το receiverAuthToken αντιστοιχεί σε λογαριασμό που υπάρχει. Στη συνέχεια, ορίζουμε ένα String output και βρίσκουμε αν υπάρχει το μήνυμα με messageId στο messageBox του receiver.
  
  Αν ναι, τότε το isRead του μηνύματος message που βρήκαμε γίνεται true και το output παίρνει την τιμή (message.sender) message.body

  Αλλιώς, το output παίρνει την τιμή "Message ID does not exist".

  Σε κάθε περίπτωση επιστρέφεται το output.  
  
* ####  DeleteMessage:  

  Η μέθοδος DeleteMessage δέχεται το String receiverAuthToken και το ακέραιο messageId. Η μέθοδος διαγράφει το μήνυμα με id το messageId από το messageBox του λογαριασμού receiver και επιστρέφει το String "ΟΚ" αν ο λογαριασμός με authToken το receiverAuthToken έχει λάβει  το μήνυμα με id το messageId. Αν δεν το έχει λάβει τότε επιστρέφει το String "Message does not exist".

  Αρχικά εντοπίζεται ο λογαριασμός receiver που έχει authToken το receiverAuthToken. Αυτός ο λογαριασμός σίγουρα υπάρχει γιατί ελεγχθεί στον client ότι το receiverAuthToken αντιστοιχεί σε λογαριασμό που υπάρχει. Στη συνέχεια, ορίζουμε ένα String output και βρίσκουμε αν υπάρχει το μήνυμα με messageId στο messageBox του receiver και αν υπάρχει τότε αποθηκεύουμε στην ακέραια μεταβλητή index σε ποια θέση του messageBox είναι.
  
  Αν υπάρχει, τότε το μήνυμα που βρήκαμε αφαιρείται από το messageBox και το output παίρνει την τιμή "OK".

  Αλλιώς, το output παίρνει την τιμή "Message does not exist".

  Σε κάθε περίπτωση επιστρέφεται το output.  
  










